<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>路由交换 | KnowledgeBase</title>
    <meta name="description" content="Learning knowledge, fast people step!">
    
    
    <link rel="preload" href="/learn/assets/css/0.styles.e19beef7.css" as="style"><link rel="preload" href="/learn/assets/js/app.a8226e81.js" as="script"><link rel="preload" href="/learn/assets/js/5.c3b07587.js" as="script"><link rel="prefetch" href="/learn/assets/js/10.b12e31be.js"><link rel="prefetch" href="/learn/assets/js/11.28002d60.js"><link rel="prefetch" href="/learn/assets/js/2.19583237.js"><link rel="prefetch" href="/learn/assets/js/3.10972525.js"><link rel="prefetch" href="/learn/assets/js/4.adcf04ab.js"><link rel="prefetch" href="/learn/assets/js/6.1102ffa8.js"><link rel="prefetch" href="/learn/assets/js/7.9290bd73.js"><link rel="prefetch" href="/learn/assets/js/8.ff25488d.js"><link rel="prefetch" href="/learn/assets/js/9.c4bafbca.js">
    <link rel="stylesheet" href="/learn/assets/css/0.styles.e19beef7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/learn/" class="home-link router-link-active"><!----> <span class="site-name">KnowledgeBase</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/learn/" class="nav-link">index</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Node.js</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/learn/zh/guide/nodejs/summary.html" class="nav-link">personal summary</a></li><li class="dropdown-item"><h4>Demo</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn/zh/guide/nodejs/" class="nav-link">nodejs创建项目</a></li><li class="dropdown-subitem"><a href="/learn/zh/guide/nodejs/youdao.html" class="nav-link">有道精品课链接分析Demo</a></li></ul></li><li class="dropdown-item"><h4>Bank</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="http://nodejs.cn/latest-api/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  node.js官方文档
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Vue.js</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/learn/zh/guide/vuejs/" class="nav-link">personal summary</a></li><li class="dropdown-item"><h4>Demo</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn/zh/guide/vuejs/2.html" class="nav-link">EduCat</a></li></ul></li><li class="dropdown-item"><h4>Bank</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://cn.vuejs.org/v2/guide/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue.js官方文档
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div><div class="nav-item"><a href="/learn/zh/guide/network/" class="nav-link router-link-exact-active router-link-active">Network</a></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  google
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/pingxi/learn" target="_blank" rel="noopener noreferrer" class="repo-link">
    source
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/learn/" class="nav-link">index</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Node.js</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/learn/zh/guide/nodejs/summary.html" class="nav-link">personal summary</a></li><li class="dropdown-item"><h4>Demo</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn/zh/guide/nodejs/" class="nav-link">nodejs创建项目</a></li><li class="dropdown-subitem"><a href="/learn/zh/guide/nodejs/youdao.html" class="nav-link">有道精品课链接分析Demo</a></li></ul></li><li class="dropdown-item"><h4>Bank</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="http://nodejs.cn/latest-api/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  node.js官方文档
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Vue.js</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/learn/zh/guide/vuejs/" class="nav-link">personal summary</a></li><li class="dropdown-item"><h4>Demo</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/learn/zh/guide/vuejs/2.html" class="nav-link">EduCat</a></li></ul></li><li class="dropdown-item"><h4>Bank</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://cn.vuejs.org/v2/guide/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue.js官方文档
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div><div class="nav-item"><a href="/learn/zh/guide/network/" class="nav-link router-link-exact-active router-link-active">Network</a></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  google
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/pingxi/learn" target="_blank" rel="noopener noreferrer" class="repo-link">
    source
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>路由交换</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/learn/zh/guide/network/#ospf协议" class="sidebar-link">OSPF协议</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learn/zh/guide/network/#概念" class="sidebar-link">概念</a></li><li class="sidebar-sub-header"><a href="/learn/zh/guide/network/#ospf中的四种路由器" class="sidebar-link">OSPF中的四种路由器</a></li><li class="sidebar-sub-header"><a href="/learn/zh/guide/network/#dr和bdr的选举" class="sidebar-link">DR和BDR的选举</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="路由交换"><a href="#路由交换" aria-hidden="true" class="header-anchor">#</a> 路由交换</h1> <h2 id="ospf协议"><a href="#ospf协议" aria-hidden="true" class="header-anchor">#</a> OSPF协议</h2> <blockquote><p>OSPF(Open Shortest Path First)是一个内部网关协议(Interior Gateway Protocol,简称IGP)，用于在单一自治系统(autonomous system,AS)内决策路由。与RIP相对，OSPF是链路状态路由协议，而RIP是距离向量路由协议。</p></blockquote> <h3 id="概念"><a href="#概念" aria-hidden="true" class="header-anchor">#</a> 概念</h3> <ul><li>骨干区域：起到了让其他非骨干区域能够知道别的区域的网络情况的作用。也就是说，所有非骨干区域的路由信息都要流经骨干区域。</li> <li>虚拟链路：是一个通过非骨干区域到骨干区域的链路。</li></ul> <ol><li>使用目的：  
连接一个非骨干区域到一个骨干区域通过一个非骨干区域 ;
通过一个非骨干区，连接分开的两个骨干区部分。</li> <li>规则：  
必须在两个ABR之间进行配置;
虚链路通过的区域作为传输区域，必须有完整的路由信息;
间传输区不能是存根区。</li></ol> <ul><li>OSPF的分层拓扑的优势：
1） 降低SPF的计算频率 2） 减小路由表 3） 降低LSU更新的开销</li></ul> <h3 id="ospf中的四种路由器"><a href="#ospf中的四种路由器" aria-hidden="true" class="header-anchor">#</a> OSPF中的四种路由器</h3> <ul><li>内部路由器:所有端口在同一区域的路由器，维护一个链路状态数据库。</li> <li>主干路由器：具有连接主干区域端口的路由器。</li> <li>区域边界路由器(ABR): 具有连接多区域端口的路由器，一般作为一个区域的出口。ABR为每一个所连接的区域建立链路状态数据库，负责将所连接区域的路由摘要信息发送到主干区域，而主干区域上的ABR则负责将这些信息发送到各个区域。</li> <li>自治域系统边界路由器(ASBR): 至少拥有一个连接外部自治域网络（如非OSPF的网络）端口的路由器，负责将非OSPF网络信息传入OSPF网络。</li></ul> <h3 id="dr和bdr的选举"><a href="#dr和bdr的选举" aria-hidden="true" class="header-anchor">#</a> DR和BDR的选举</h3> <ol><li>问题引出</li></ol> <p>在运行OSPF的MA网络中包括广播型和NBMA网络会存在两个问题：</p> <pre><code>1）在一个有n个路由器的网络中，会形成（n*(n-1))/2邻居关系。

2）邻居间LSA的泛洪扩散混乱，相同的LSA会被复制多份，
</code></pre> <p>这样的工作效率显然是很低的，消耗资源，那么如何解决这个问题的呢？</p> <ol start="2"><li>DR与BDR的作用</li></ol> <p>1）DR（designated router）即指定路由，其负责在MA网络建立和维护邻接关系并负责LSA的同步。</p> <p>2）DR与其他所有的路由器形成邻接关系并交换链路状态信息，其他路由器之间不直接交换链路状态信息，这样就大大减少了MA网络中的邻接关系数据 及交换链路状态信息消耗的资源。</p> <p>3）DR一旦出现故障，其与其他路由器之间的邻接关系将全部失效，链路状态数据库也无法同步，此时就需要重新选举DR、再与非DR路由器建立邻接关系，完成LSA的同步，为了规避单点故障风险，通过选举备份指定路由器BDR，在DR失效时快速接管DR的工作。</p> <ol start="3"><li>DR与BDR的选举规则</li></ol> <p>1）DR/BDR的选举是基于接口的</p> <p>2）接口的DR优先级越大越优先。接口的DR优先级相等时，router ID越大越优先。</p> <p>3）接口DR优先级相等时，router ID越大越优先</p> <p>4）接口DR优先级为0，表示不参与选举，router priority最大不一定是DR/BDR</p> <p>5）在P2P网络及P2MP网络上具有邻居关系的路由器之间会进一步建立邻接关系。但在广播型及NBMA网络上，非DRBDR路由器之间只能建立邻居关系，不能建立邻接关系。非DR/BDR路由器与DR/BDR路由器之间会建立邻接关系，DR与BDR之间也会建立邻接关系。</p> <ol start="4"><li>DR和BDR的选举</li></ol> <p>1.优先级为0的不参与选举；</p> <p>2.优先级高的路由器为DR；</p> <p>3.优先级相同时，以router ID 大为DR；router ID 以回环接口中最大ip为准；若无回环接口，以真实接口最大ip为准。</p> <p>4.缺省条件下，优先级为1。</p> <p>5.要注意的是,当网络中已经选举了DR/BDR后,又出现了1台新的优先级更高的路由器,DR/BDR是不会重新选举的。</p> <p>6.DR/BDR选举完成后,DRother只和DR/BDR形成邻接关系.所有的路由器将组播Hello包到AllSPFRouters地址224.0.0.5以便它们能跟踪其他邻居的信息,即DR将泛洪update packet到224.0.0.5;DRother只组播update packet到AllDRouter地址224.0.0.6,只有DR/BDR监听这个地址</p> <p>7.先选举BDR，在选举DR。</p> <p>8.ID的产生优先级：route id&gt;loopback address&gt;route接口最高IP</p> <ol start="5"><li>DR和BDR的选举需要注意以下四点：</li></ol> <p>1）只有在广播或NBMA类型接口时才会选举DR，在点到点或点到多点类型的接口上不需要选举DR。
   2）DR是指某个网段的概念，是针对路由器的接口而言的。某台路由器在一个接口上可能是DR，在另一个接口上有可能是BDR，或者是DR Other。
   3）若DR、BDR已经选择完毕，当一台新路由器加入后，即使它的DR优先级值最大，也不会立即成为该网段中的DR。
              4）DR并不一定就是DR优先级最大的路由器；同理，BDR也并不一定就是DR优先级第二大的路由器。</p></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/pingxi/learn/edit/master/docs/zh/guide/network/README.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></div> <!----> </div> <!----></div></div>
    <script src="/learn/assets/js/app.a8226e81.js" defer></script><script src="/learn/assets/js/5.c3b07587.js" defer></script>
  </body>
</html>
